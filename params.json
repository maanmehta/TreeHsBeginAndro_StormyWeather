{
  "name": "Weather App",
  "tagline": "This android app determines users current location automatically and then retrieves and displays current  weather data and hourly and daily forecast for next seven days",
  "body": "# Weather Android App\r\n## Detailed Design and Functionality\r\n\r\n### About this app\r\n\r\nThis android app provides following features using established Google design patterns and Google APIs:\r\n\r\n1. Automatically determine current location using Location Services\r\n2. Retrieves Weather data from forecast.io REST web service\r\n3. Displays details of current weather on the main screen\r\n4. Displays 7-day forecast\r\n5. Displays hourly forecast\r\n6. Displays current location in a Google Map view and the nearest address determined using reverse GeoCoding\r\n\r\n### About this document\r\nPurpose of this document is to provide:\r\n - functionality provided by this app,\r\n - detailed technical design for important features\r\n\r\n# 1 Main Screens / Activities\r\n\r\nThe app has following screens or activities:\r\n\r\n- Current Weather\r\n- Your Location\r\n- Next 7-days Forecast\r\n- Hourly Forecast\r\n\r\n# 2 Current Weather\r\n\r\n## 2.1 User Interface and Functionality\r\n![Current Weather](https://raw.githubusercontent.com/maanmehta/screenshots/master/stormy/CurrentWeather.png)\r\n\r\nAbove screenshot shows the main screen of the app that displays the current weather conditions. It implements following functionality:\r\n* When the user clicks the temperature text, it toggles from celsius to Fahrenheit as shown in the above screenshots\r\n* Location of the user is detected automatically using Location Services.\r\n* We then get the user's current Latitude and Longitude from the Location object\r\n* User's current latitude and longitude are then sent as URL parameters to REST web service call to forecast.io to receive the detailed weather data. This weather dats is received in JSON format and contains current weather details and hourly and daily forecast.\r\n* Screen displays user's current city which is determined using Reverse-Gecoding from the user's Location object\r\n* At the bottom of the screen, there are two buttons that start two new activities - one  displays hourly forecast and the other displays next week's forecast\r\n* Map Activity - If the user clicks on either the City name or the weather condition icon at the top of the screen, a new activity (screen) is displayed that shows users current location in a map fragment and also displays user's nearest address.\r\n\r\n## 2.2 Main code artifacts for this Activity\r\n* View (Layout XML) - [activity_main.xml](https://github.com/maanmehta/TreeHsBeginAndro_StormyWeather/blob/master/app/src/main/res/layout/activity_main.xml)\r\n* Activity - [MainActivity.java](https://github.com/maanmehta/TreeHsBeginAndro_StormyWeather/blob/master/app/src/main/java/mun/treehsbeginandro_stormy/ui/MainActivity.java)\r\n* Model Classes - [Forecast.java, Current.java, Hour.java and Day.java](https://github.com/maanmehta/TreeHsBeginAndro_StormyWeather/tree/master/app/src/main/java/mun/treehsbeginandro_stormy/weather)\r\n\r\n## 2.3 Adding automatic location determination - Google Play Services Location API\r\n\r\nGoogle Play Services provides provides Location API which you can use to add location awareness to android apps. Google Training website has a step-by-step guide at this [link](https://developer.android.com/training/location/index.html). Follow the steps in this training guide.\r\n\r\n### Implement Listeners\r\n\r\nAdd following Listeners to the `MainActivity.java`:\r\n- GoogleApiClient.ConnectionCallbacks,\r\n- GoogleApiClient.OnConnectionFailedListener,\r\n- LocationListener\r\n\r\n```java\r\npublic class MainActivity extends AppCompatActivity\r\n        implements\r\n        GoogleApiClient.ConnectionCallbacks,\r\n        GoogleApiClient.OnConnectionFailedListener,\r\n        LocationListener\r\n```\r\n\r\n### onCreate method\r\n\r\nCreate and initialize the `GoogleApiClient` and `LocationRequest` objects in the `onCreate` method as follows:\r\n\r\n```java\r\n// Build and initialize GoogleApiClient instance\r\nmGoogleApiClient = new GoogleApiClient.Builder(this)\r\n        .addConnectionCallbacks(this)\r\n        .addOnConnectionFailedListener(this)\r\n        .addApi(LocationServices.API)\r\n        //.addApi(AppIndex.API)\r\n        .build();\r\n\r\n// Create the LocationRequest object - this will have minimal impacts on power\r\nmLocationRequest = LocationRequest.create()\r\n        .setPriority(LocationRequest.PRIORITY_HIGH_ACCURACY)\r\n        .setInterval(60 * 60 * 1000)        // 60 minutes, in milliseconds\r\n        .setFastestInterval(1 * 60 * 1000); // 1 minute, in milliseconds\r\n```\r\n\r\n### onConnected method\r\n\r\nGet the current location in the onConnected method as follows\r\n\r\n```java\r\nmCurrentLocation = LocationServices.FusedLocationApi.getLastLocation(mGoogleApiClient);\r\n\r\nif (mCurrentLocation == null) {\r\n    // Location can be null when the last location is unknown, therefore getLastLocation\r\n    // returns null location, so we need to use requestLocationUpdates api and provide a\r\n    // LocationRequest object\r\n    LocationServices.FusedLocationApi.requestLocationUpdates(mGoogleApiClient, mLocationRequest, this);\r\n}\r\n\r\n// Now that we have location object, we can call our custom method to get Forecast JSON from weather webservice\r\ngetForecast();\r\n```\r\n\r\n### Permission to get precise location with ACCESS_FINE_LOCATION\r\nFor our app, we decided to use fine location detection, so that your app can get as precise a location as possible from the available location providers. For this, we added the following `uses-permission` element in our app manifest file as follows:\r\n\r\n```xml\r\n<uses-permission android:name=\"android.permission.ACCESS_FINE_LOCATION\"/>\r\n```\r\n\r\n### Activity lifecycle methods - onStart, onResume, onPause and onStop\r\n\r\nIn the activity lifecycle methods, connect and disconnect GoogleApiClient object and since in onConnected, we called requestLocationUpdates, in onPause, we should call removeLocationUpdates so we ap is no longer getting loation updates when it has paused\r\n\r\n```java\r\n@Override\r\npublic void onStart() {\r\n    super.onStart();\r\n\r\n    mGoogleApiClient.connect();\r\n}\r\n\r\n@Override\r\nprotected void onResume() {\r\n    super.onResume();\r\n\r\n    mGoogleApiClient.connect();\r\n}\r\n\r\n@Override\r\nprotected void onPause() {\r\n    super.onPause();\r\n    if (mGoogleApiClient.isConnected()) {\r\n\r\n        // remove location Updates when the application pauses so it does not continue to request\r\n        //location updates and drain power and battery. When the app resumes, it will need\r\n        // again start requesting location updates. In our code, onResume, calls connect which\r\n        // calls onConnected with is where we have added code to requestLocationUpdates again\r\n        LocationServices.FusedLocationApi.removeLocationUpdates(mGoogleApiClient, this);\r\n\r\n        // onPause, disconnect GoogleAPIClient, on Resume, we will need to connect again\r\n        mGoogleApiClient.disconnect();\r\n    }\r\n}\r\n\r\n@Override\r\npublic void onStop() {\r\n    super.onStop();\r\n\r\n    mGoogleApiClient.disconnect();\r\n}\r\n```\r\n\r\n###onLocationChanged\r\nSince we are requesting location updates, app will continue to get the new location object, therefore, in the `onLocationChanged` method we need to save the changed location to our mCurrentLocation property of the class\r\n```java\r\n@Override\r\npublic void onLocationChanged(Location location) {\r\n    mCurrentLocation = location;\r\n}\r\n```\r\n\r\n## 2.4 Get Weather forecast for current location - Call REST web service\r\n\r\n## 2.5 Reverse GeoCoding - Get nearest address based on current location\r\n\r\n## 2.6 Swipe down to refresh screen using SwipeRefreshLayout\r\n![SwipeRefresh1](https://raw.githubusercontent.com/maanmehta/screenshots/master/stormy/SwipeRefresh1.png)\r\n\r\nUsed `SwipeRefreshLayout` to implement the functionality where the user can swipe or drag down the screen to refresh its contents. When the user drags or swipes down the screen, screen shows a circular spinning progress icon and `onRefresh` event is triggered and the app developer can handle that event and implement the desired functionality. In this app we are calling our `getForecast()` when we handle that event.\r\n\r\n### Layout\r\n\r\nFollowing is the layout xml snippet where the SwipeRefreshLayout is the top level layout now that wraps the top RelativeLayout\r\n\r\n```xml\r\n<android.support.v4.widget.SwipeRefreshLayout\r\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:id=\"@+id/swipeToRefresh\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\">\r\n\r\n    <RelativeLayout\r\n        android:id=\"@+id/topRL4MainActivity\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"match_parent\"\r\n        android:background=\"@drawable/bg_gradient_blue\"\r\n        android:paddingLeft=\"@dimen/activity_horizontal_margin\"\r\n        android:paddingRight=\"@dimen/activity_horizontal_margin\"\r\n        android:paddingTop=\"@dimen/activity_vertical_margin\"\r\n        android:gravity=\"center\"\r\n        tools:context=\".ui.MainActivity\">\r\n```\r\n\r\n### onRefresh() method\r\nFollowing is the code snippet from the `onCreate()` method of the `MainActivity.java` where we set `OnRefreshListener` and handle the `OnRefresh()` method.\r\n\r\n```java\r\nmSwipeRefreshLayout = (SwipeRefreshLayout)findViewById(R.id.swipeToRefresh);\r\nmSwipeRefreshLayout.setColorSchemeResources(R.color.Red,R.color.Orange,R.color.Blue,R.color.Green);\r\nmSwipeRefreshLayout.setOnRefreshListener(new SwipeRefreshLayout.OnRefreshListener() {\r\n     @Override\r\n     public void onRefresh() {\r\n          Log.d(TAG,\"************** SWIPE REFRESH EVENT TRIGGERED!!!!!\");\r\n          getForecast();\r\n});\r\n```\r\n\r\n### Bug with SwipeRefreshLayout\r\nI encountered a bug with SwipeRefreshLayout where the swipe down functionality would not trigger properly. I noticed that circular progress animation did not work properly and also the event was not fired most of the time. Then I stumbled upon a pattern that it worked fine whenever I started my swipe down on a TextField which had an `OnClickListener` set. To verify this, I set `OnClickListener` to another icon on the screen and saw the same behaviour. Therefore, to fix this bug, I set an `OnClickListener` to the top most `RelativeLayout` which was a child element to SwipeRefreshLayout and kept its `onClick()` method just empty. This fixed the bug and now the screen could be dragged down from anywhere. Here is the code snippet from the `onCreate` method of the `MainActivity.java`\r\n\r\n```java\r\n// Bug fix for Swipe Refresh - Adding onClickListener to RelativeLayout inside the SwipeRefresh\r\nmRL = (RelativeLayout) findViewById(R.id.topRL4MainActivity);\r\nmRL.setOnClickListener(new View.OnClickListener() {\r\n    @Override\r\n    public void onClick(View v) {\r\n        // Just empty method - do nothing\r\n    }\r\n});\r\n```\r\n\r\n# 3 Your Location\r\n\r\n## 3.1 User Interface\r\n![Current Weather](https://raw.githubusercontent.com/maanmehta/screenshots/master/stormy/YourLocation.png)\r\n\r\n## 3.2 Get Google Maps API Key\r\n\r\nProject Id - <automatically named by google maps api when I created a new project)\r\nAPI Key name: <You provide this on Google wizard>\r\nPackage name: Get this from your Android app's Manifest xml file\r\n\r\nTo get Certificate fingerprint(MD5) code follow these steps\r\n\r\n1. Go to - C:\\Program Files\\Java\\jdk1.6.0_26\\bin\r\n2. Inside the bin folder run the jarsigner.exe file\r\n3. Open cmd prompt and execute the following two commands:\r\n```dos\r\nC:\\Program Files\\Java\\jdk1.6.0_26\\bin\r\nkeytool -list -keystore \"C:/Users/your user name/.android/debug.keystore\"\r\n```\r\nIt will ask for Keystore password now. The default is \"android\" type and enter\r\n\r\n\r\nMy steps - Open Windows prompt\r\n```dos\r\ncd C:\\Java\\jdk1.8.0_91\\bin\r\n\r\nC:\\Java\\jdk1.8.0_91\\bin>keytool -list -keystore \"C:/Users/Mun/.android/debug.keystore\"\r\nEnter keystore password: android\r\n\r\nKeystore type: JKS\r\nKeystore provider: SUN\r\n\r\nYour keystore contains 1 entry\r\n\r\nandroiddebugkey, Jul 12, 2016, PrivateKeyEntry,\r\nCertificate fingerprint (SHA1): <removed>\r\n\r\n\r\nAfter entering the above SHA-1 fingerprint in google wizard, got the following API key\r\n<removed>\r\n\r\n```\r\n\r\nYou can always see the Credentials you have created by visiting the following URL: https://console.developers.google.com/apis/credentials?project=evident-axle-138523&authuser=1\r\n\r\n\r\n# 4 Next 7-days Forecast\r\n## 4.1 User Interface\r\n![Current Weather](https://raw.githubusercontent.com/maanmehta/screenshots/master/stormy/Next7DaysForecast.png)\r\n\r\n# 5 Hourly Forecast\r\n## 5.1 User Interface\r\n![Current Weather](https://raw.githubusercontent.com/maanmehta/screenshots/master/stormy/HourlyForecast.png)\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}